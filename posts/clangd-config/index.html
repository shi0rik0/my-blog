<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.1.7"><title></title><link rel="stylesheet" href="/_astro/index.CsOifZER.css"></head> <body class="bg-[#333] text-[#ddd]"> <h1>Sustie</h1> <div class="flex gap-4"> <a href="/">主页</a> <a href="/posts/">所有文章</a> <a href="/search/">文章检索</a> </div>  <h1>关于clangd的配置文件</h1> <p>clangd 是一个可以分析 C++代码，并帮助编辑器进行代码补全、跳转等功能的工具，但是 clangd 不会自动分析项目的 include 路径、编译选项等信息，这些信息需要通过配置文件来提供。clangd 支持两种配置文件，第一种是<code>compile_commands.json</code>，这个文件会给项目中的每一个源文件分别指定编译选项，通常这个文件是由程序自动生成的。第二种则是<code>compile_flags.txt</code>，这个文件会给项目中的所有文件指定相同的编译选项，这个文件往往是手动编写的。</p> <h2>配置文件的查找路径</h2> <p>clangd 的文档写得不是很清楚，根据我所了解的信息，clangd 查找配置文件的逻辑大概是这样的：</p> <p>如果使用的是<code>compile_flags.txt</code>，那么 clangd 只会在项目根目录下查找这个文件。如果使用的是<code>compile_commands.json</code>，那么 clangd 会从当前编辑的源文件所在的目录开始，逐级向上查找<code>compile_commands.json</code>，并且途中也会在每一个目录的<code>build/</code>目录下查找。举个例子，假如当前编辑的文件是<code>/app/src/foo.cpp</code>，那么 clangd 会依次在以下目录查找：<code>/app/src/</code>、<code>/app/src/build/</code>、<code>/app/</code>、<code>/app/build/</code>……。目前似乎没有办法手动指定配置文件的路径。</p> <h2>compile_flags.txt 的格式</h2> <p><code>compile_flags.txt</code>的格式非常简单，只需要在每一行写一个<code>clang</code>的编译选项即可。例如：</p> <pre><code class="language-txt">-I/usr/include
-std=c++17
-Wall
-Wextra
</code></pre> <h2>使用 CMake 生成 compile_commands.json</h2> <p>要使用 CMake 生成<code>compile_commands.json</code>，只需要在<code>CMakeLists.txt</code>中启用该功能即可：</p> <pre><code class="language-cmake">set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
</code></pre> <p>这样在构建项目的时候，CMake 就会在生成目录（通常是<code>build/</code>）下面生成<code>compile_commands.json</code>文件。</p> <h2>使用 Bear 生成 compile_commands.json</h2> <p>对于使用传统的 Makefile 构建的项目，可以使用<a href="https://github.com/rizsotto/Bear">Bear 工具</a>来生成<code>compile_commands.json</code>。在 Ubuntu 下，Bear 可以通过 APT 安装，包名为<code>bear</code>。</p>  </body></html>