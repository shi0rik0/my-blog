<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.1.7"><title></title><link rel="stylesheet" href="/_astro/index.CsOifZER.css"></head> <body class="bg-[#333] text-[#ddd]"> <h1>Sustie</h1> <div class="flex gap-4"> <a href="/">主页</a> <a href="/posts/">所有文章</a> <a href="/search/">文章检索</a> </div>  <h1>Django外键的on_delete参数</h1> <p>在 Django 的 ORM 框架中，通过<code>models.ForeignKey</code>可以很方便地创建外键字段。请看下面的例子：</p> <pre><code class="language-python">from django.db import models

class Manufacturer(models.Model):
    name = models.TextField()

class Car(models.Model):
    manufacturer = models.ForeignKey(Manufacturer, on_delete=models.PROTECT)
</code></pre> <p>在创建外键的时候，必须指定<code>on_delete</code>参数。在早期的 Django 版本中，这个参数有一个默认值<code>CASCADE</code>，而这个选项是非常危险的。假如数据库中有一些 Car 的 Manufacturer 是 BMW，那么如果设置了<code>CASCADE</code>，删除 BMW 就会将由 BMW 生产的所有 Car 的记录也一并删除，这样很可能导致数据丢失。如果设置为<code>PROTECT</code>，就会拒绝这次删除操作，并抛出一个异常。事实上，在生产环境中，往往很少直接删除记录，最多就是用一个专门的<code>deleted</code>字段来进行伪删除，因此将<code>on_delete</code>设置为<code>PROTECT</code>是我心目中的最佳实践。（<code>on_delete</code>还有一些安全性介于<code>CASCADE</code>和<code>PROTECT</code>之间的选项，例如<code>SET_NULL</code>和<code>RESTRICT</code>等等，这里就不赘述了。）</p>  </body></html>