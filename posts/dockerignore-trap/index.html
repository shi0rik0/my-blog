<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- KaTeX --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous"><!-- Prism --><link href="/lib/prism.css" rel="stylesheet"><script src="/lib/prism.js"></script><meta name="generator" content="Astro v5.1.7"><title></title><link rel="stylesheet" href="/_astro/index.CCeQH6Bz.css"></head> <body class="bg-[#333] text-[#ddd]"> <h1>Sustie</h1> <div class="flex gap-4"> <a href="/">主页</a> <a href="/posts/page/1">所有文章</a> <a href="/search/">文章检索</a> </div>  <h1>关于.dockerignore的陷阱</h1> <p>在 Docker 构建镜像的时候，默认会将 context 下的所有文件打包发送到 builder 进程。这是因为 Docker builder 采用了一种客户端/服务器的架构，这样就可以实现远程构建。但是如果 context 下面文件很大，就会影响构建速度。为此，Docker 提供了一个机制，可以通过在<code>.dockerignore</code>文件中指定要排除的文件。但是这个.dockerignore 的语法和.gitignore 有很大差异，因此很容易写错，其中一个陷阱就是，在.gitignore 中，<code>foo</code>等价于<code>**/foo</code>，而在.dockerignore 中，这等价于<code>/foo</code>。除此之外还有很多微妙的差异，比如<a href="https://zzz.buzz/2018/05/23/differences-of-rules-between-gitignore-and-dockerignore/">这篇文章</a>中指出的：</p> <blockquote> <p>In .gitignore, if a path is listed as ignored (e.g. /dir), then any files or folders under that path is ignored and it is not possible to re-include them via negation (e.g. !/dir/file) as the parent directory of them is excluded;</p> <p>while in .dockerignore, even if a parent path is ignored, files or folders under it can still be re-included via negation.</p> </blockquote>  </body></html>